<!DOCTYPE html>
<!--
============================================
SPECIMEN: HUNTERIAN TANK - MAIN INTERFACE
ORGAN: Visual Containment System
RETRIEVAL: October 2025, Lookaway Archive
============================================

STATUS: Operational - HOT AMBER PALETTE v3.0
FUNCTION: Primary specimen archive interface
DEPENDENCIES: 
  - tank-config.js (configuration constants)
  - tank-specimens.js (specimen registry)
  - tank-decay.js (lifecycle controller)
  - tank-beam.js (electron scanning)
  - tank-particles.js (atmospheric drift)
  - tank-audio.js (sound system)

SURGICAL NOTES:
Main entry point for the Lookaway Tank preservation system.
Features hot electric amber aesthetic with energetic center
(120, 100, 45) radiating through rich glow (180, 160, 90).
Includes live 24-hour clock, specimen grid with flicker
animation, and fade-to-black navigation transitions.

Data-driven architecture - specimen colors and behaviors
pulled from tank-specimens.js registry. Audio defaults to
LOW volume on first interaction.
============================================
-->
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>LOOKAWAY TANK - Hunterian Preservation System</title>

<style>
/* ============================================
   VISUAL CORTEX - Hot electric amber preservation system
   ============================================ */

:root {
    /* Preservation fluid colors - HOT AMBER PALETTE */
    --core-r: 120;
    --core-g: 100;
    --core-b: 45;
    --glow-r: 180;
    --glow-g: 160;
    --glow-b: 90;
    --text-r: 210;
    --text-g: 170;
    --text-b: 55;
    --text-opacity: 1.0;
    
    /* Title hierarchy */
    --title-r: 210;
    --title-g: 170;
    --title-b: 55;
    --subtitle-r: 140;
    --subtitle-g: 110;
    --subtitle-b: 30;
    
    /* Decay flesh popup colors - WARM TONES */
    --popup-bg-r: 90;
    --popup-bg-g: 75;
    --popup-bg-b: 50;
    --popup-border-r: 180;
    --popup-border-g: 150;
    --popup-border-b: 100;
    --popup-text-r: 220;
    --popup-text-g: 200;
    --popup-text-b: 170;
    --popup-glow-r: 180;
    --popup-glow-g: 160;
    --popup-glow-b: 90;
    --popup-label-r: 160;
    --popup-label-g: 130;
    --popup-label-b: 70;
    
    /* Membrane colors - YELLOW GLASS */
    --membrane-r: 255;
    --membrane-g: 224;
    --membrane-b: 98;
    
    /* Beam parameters */
    --beam-color-r: 180;
    --beam-color-g: 160;
    --beam-color-b: 90;
    --beam-speed: 12s;
    --beam-start-position: 0%;
    
    /* Atmosphere - MORE VISIBLE */
    --particle-base-opacity: 0.12;
    --particle-decay-multiplier: 1.0;
    
    /* Breathing */
    --breathing-speed: 30s;
    --breathing-opacity-min: 0.7;
    --breathing-opacity-max: 0.85;
    
    /* Vignette */
    --vignette-radius: 85%;
    --vignette-opacity: 0.02;
    
    /* Scanlines */
    --scanline-opacity: 0.10;
    --scanline-speed: 3.0s;
    
    /* Text effects */
    --text-glow-spread: 40px;
    --text-glow-intensity: 0.3;
    --text-title-blur: 0.2px;
    --text-body-blur: 0.15px;
    
    /* Power */
    --flicker-speed: 0.3s;
    --flicker-brightness: 1.0;
}

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    background: #000;
    overflow-x: hidden;
    font-family: 'Courier New', monospace;
    cursor: crosshair;
    -webkit-user-select: none;
    user-select: none;
}

/* CRT CONTAINER */
.crt {
    position: fixed;
    inset: 0;
    overflow-y: auto;
    overflow-x: hidden;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: flex-start; /* Start at top, not center */
    padding: 40px 0;
    min-height: 100vh; /* Ensure scrolling works */
}

/* Center content when viewport is tall enough */
@media (min-height: 900px) {
    .crt {
        justify-content: center; /* Only center on tall screens */
    }
}

.crt::before {
    content: '';
    position: fixed;
    inset: -25%;
    background: radial-gradient(
        ellipse at center,
        rgb(var(--core-r), var(--core-g), var(--core-b)) 0%,
        rgba(var(--core-r), var(--core-g), var(--core-b), 0.6) 35%,
        black 75%
    );
    opacity: var(--breathing-opacity-min);
    animation: breathe var(--breathing-speed) ease-in-out infinite;
    z-index: -1;
    pointer-events: none;
}

@keyframes breathe {
    50% { 
        opacity: var(--breathing-opacity-max);
        filter: brightness(1.2);
    }
}

/* SCANLINES */
.scanlines {
    position: fixed;
    top: -100px;
    left: 0;
    width: 100vw;
    height: calc(100vh + 200px);
    background: repeating-linear-gradient(
        to bottom,
        transparent 0,
        transparent 2px,
        black 2px,
        black 4px
    );
    background-size: 100% 4px;
    opacity: var(--scanline-opacity);
    animation: scan var(--scanline-speed) linear infinite;
    pointer-events: none;
    z-index: 999;
}

@keyframes scan {
    to { transform: translateY(4px); }
}

/* VIGNETTE */
.vignette {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: radial-gradient(
        circle at center,
        transparent var(--vignette-radius),
        rgba(0, 0, 0, var(--vignette-opacity)) 100%
    );
    pointer-events: none;
    z-index: 4;
}

/* TANK BORDER - BRIGHT Glowing containment frame */
.tank-border {
    position: fixed;
    inset: 8px; /* Distance from viewport edge */
    border: 2px solid rgba(var(--glow-r), var(--glow-g), var(--glow-b), 0.8);
    box-shadow: 
        0 0 20px rgba(var(--glow-r), var(--glow-g), var(--glow-b), 0.8),
        0 0 40px rgba(var(--glow-r), var(--glow-g), var(--glow-b), 0.5),
        inset 0 0 20px rgba(var(--glow-r), var(--glow-g), var(--glow-b), 0.4);
    pointer-events: none;
    z-index: 5;
    animation: border-pulse 4s ease-in-out infinite;
}

@keyframes border-pulse {
    0%, 100% {
        opacity: 0.85;
        box-shadow: 
            0 0 20px rgba(var(--glow-r), var(--glow-g), var(--glow-b), 0.8),
            0 0 40px rgba(var(--glow-r), var(--glow-g), var(--glow-b), 0.5),
            inset 0 0 20px rgba(var(--glow-r), var(--glow-g), var(--glow-b), 0.4);
    }
    50% {
        opacity: 1.0;
        box-shadow: 
            0 0 30px rgba(var(--glow-r), var(--glow-g), var(--glow-b), 1.0),
            0 0 60px rgba(var(--glow-r), var(--glow-g), var(--glow-b), 0.7),
            inset 0 0 30px rgba(var(--glow-r), var(--glow-g), var(--glow-b), 0.6);
    }
}

/* TANK HEADER */
.tank-header {
    text-align: center;
    padding: 0 20px 40px 20px;
    position: relative;
    z-index: 2;
}

.archive-title {
    font-size: 24px;
    color: rgb(var(--title-r), var(--title-g), var(--title-b));
    text-transform: uppercase;
    letter-spacing: 5px;
    margin-bottom: 15px;
    text-shadow: 
        0 0 8px rgba(var(--title-r), var(--title-g), var(--title-b), 1.0),
        0 0 16px rgba(var(--title-r), var(--title-g), var(--title-b), 0.8),
        0 0 32px rgba(var(--title-r), var(--title-g), var(--title-b), 0.6);
    filter: blur(var(--text-title-blur)) brightness(var(--flicker-brightness));
    animation: title-flicker var(--flicker-speed) infinite;
}

.archive-subtitle {
    font-size: 13px;
    color: rgb(var(--subtitle-r), var(--subtitle-g), var(--subtitle-b));
    letter-spacing: 2px;
    font-style: italic;
    text-shadow: 
        0 0 4px rgba(var(--subtitle-r), var(--subtitle-g), var(--subtitle-b), 0.5);
}

@keyframes title-flicker {
    0%, 100% { opacity: 1; }
    3% { opacity: 0.55; }
    5% { opacity: 1; }
    7% { opacity: 0.6; }
    9% { opacity: 1; }
    45% { opacity: 1; }
    46% { opacity: 0.5; }
    47% { opacity: 1; }
    80% { opacity: 1; }
    82% { opacity: 0.6; }
    83% { opacity: 1; }
}

/* MEMBRANE GRID */
.membrane-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 25px;
    max-width: 900px;
    width: 100%;
    padding: 0 40px;
    position: relative;
    z-index: 2;
}

/* TANK FOOTER */
.tank-footer {
    text-align: center;
    padding: 40px 20px 0 20px;
    position: relative;
    z-index: 2;
}

.date-tag {
    font-size: 11px;
    color: rgb(var(--subtitle-r), var(--subtitle-g), var(--subtitle-b));
    letter-spacing: 2px;
    text-transform: uppercase;
    text-shadow: 
        0 0 4px rgba(var(--subtitle-r), var(--subtitle-g), var(--subtitle-b), 0.5);
    opacity: 0.8;
}

/* MEMBRANE BUTTONS - ROUNDED RECTANGLES */
.membrane {
    position: relative;
    aspect-ratio: 7/3;
    min-height: 90px;
    max-height: 110px;
    padding: 8px 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    
    /* Default fallback - will be overridden by specimen color */
    background: rgba(var(--membrane-r), var(--membrane-g), var(--membrane-b), 0.05);
    backdrop-filter: blur(10px) saturate(1.2);
    border: 1px solid rgba(var(--membrane-r), var(--membrane-g), var(--membrane-b), 0.3);
    border-radius: 8px;
    
    box-shadow: 
        inset 0 0 20px rgba(var(--membrane-r), var(--membrane-g), var(--membrane-b), 0.1),
        0 4px 20px rgba(0, 0, 0, 0.5);
    
    transition: all 0.3s ease;
    cursor: crosshair;
}

/* Specimen-specific coloring (data-driven) */
.membrane.has-specimen {
    background: rgba(var(--specimen-r), var(--specimen-g), var(--specimen-b), 0.05);
    border: 1px solid rgba(var(--specimen-r), var(--specimen-g), var(--specimen-b), 0.3);
    box-shadow: 
        inset 0 0 20px rgba(var(--specimen-r), var(--specimen-g), var(--specimen-b), 0.1),
        0 4px 20px rgba(0, 0, 0, 0.5);
}

.membrane.has-specimen:hover {
    background: rgba(var(--specimen-r), var(--specimen-g), var(--specimen-b), 0.08);
    border-color: rgba(var(--specimen-r), var(--specimen-g), var(--specimen-b), 0.6);
    transform: translateY(-2px);
    box-shadow: 
        inset 0 0 25px rgba(var(--specimen-r), var(--specimen-g), var(--specimen-b), 0.15),
        0 8px 30px rgba(0, 0, 0, 0.6),
        0 0 20px rgba(var(--specimen-r), var(--specimen-g), var(--specimen-b), 0.3);
}

.membrane.has-specimen.beam-contact {
    border-color: rgba(var(--specimen-r), var(--specimen-g), var(--specimen-b), 0.9);
    box-shadow: 
        inset 0 0 30px rgba(var(--specimen-r), var(--specimen-g), var(--specimen-b), 0.3),
        0 0 20px rgba(var(--specimen-r), var(--specimen-g), var(--specimen-b), 0.6);
}

/* Idle Animations - Subtle floating in fluid */
.membrane.anim-float {
    animation: membrane-float var(--anim-speed, 4s) ease-in-out infinite;
}

.membrane.anim-breathe {
    animation: membrane-breathe var(--anim-speed, 5s) ease-in-out infinite;
}

.membrane.anim-pulse {
    animation: membrane-pulse var(--anim-speed, 3s) ease-in-out infinite;
}

.membrane.anim-drift {
    animation: membrane-drift var(--anim-speed, 6s) ease-in-out infinite;
}

@keyframes membrane-float {
    0%, 100% { 
        transform: translateY(0px) translateX(0px);
    }
    25% { 
        transform: translateY(-3px) translateX(1px);
    }
    50% { 
        transform: translateY(-5px) translateX(-1px);
    }
    75% { 
        transform: translateY(-2px) translateX(0px);
    }
}

@keyframes membrane-breathe {
    0%, 100% { 
        transform: scale(1);
        opacity: 1;
    }
    50% { 
        transform: scale(1.02);
        opacity: 0.95;
    }
}

@keyframes membrane-pulse {
    0%, 100% { 
        box-shadow: 
            inset 0 0 20px rgba(var(--specimen-r), var(--specimen-g), var(--specimen-b), 0.1),
            0 4px 20px rgba(0, 0, 0, 0.5);
    }
    50% { 
        box-shadow: 
            inset 0 0 30px rgba(var(--specimen-r), var(--specimen-g), var(--specimen-b), 0.2),
            0 4px 25px rgba(0, 0, 0, 0.6),
            0 0 15px rgba(var(--specimen-r), var(--specimen-g), var(--specimen-b), 0.3);
    }
}

@keyframes membrane-drift {
    0%, 100% { 
        transform: translateX(0px) rotate(0deg);
    }
    25% { 
        transform: translateX(2px) rotate(0.5deg);
    }
    50% { 
        transform: translateX(-2px) rotate(-0.5deg);
    }
    75% { 
        transform: translateX(1px) rotate(0.2deg);
    }
}

.membrane:hover {
    background: rgba(var(--membrane-r), var(--membrane-g), var(--membrane-b), 0.08);
    border-color: rgba(var(--membrane-r), var(--membrane-g), var(--membrane-b), 0.5);
    transform: translateY(-2px);
    box-shadow: 
        inset 0 0 25px rgba(var(--membrane-r), var(--membrane-g), var(--membrane-b), 0.15),
        0 8px 30px rgba(0, 0, 0, 0.6);
}

.membrane.beam-contact {
    border-color: rgba(var(--membrane-r), var(--membrane-g), var(--membrane-b), 0.9);
    box-shadow: 
        inset 0 0 30px rgba(var(--membrane-r), var(--membrane-g), var(--membrane-b), 0.3),
        0 0 20px rgba(var(--membrane-r), var(--membrane-g), var(--membrane-b), 0.6);
}

/* Empty membranes - COMPLETELY DEAD */
.membrane.empty {
    opacity: 0.3;
    cursor: default;
    background: rgba(60, 60, 60, 0.02);
    border-color: rgba(80, 80, 80, 0.15);
    filter: grayscale(1);
}

.membrane.empty:hover {
    transform: none;
    background: rgba(60, 60, 60, 0.02);
    border-color: rgba(80, 80, 80, 0.15);
}

.membrane.empty .membrane-code {
    color: rgba(100, 100, 100, 0.4);
    text-shadow: none;
}

/* MEMBRANE TEXT - BIGGER WITH FLICKER */
.membrane-code {
    font-size: 14px;
    font-weight: bold;
    letter-spacing: 2px;
    text-transform: uppercase;
    text-align: center;
    color: rgb(var(--text-r), var(--text-g), var(--text-b));
    text-shadow: 
        0 0 6px rgba(var(--glow-r), var(--glow-g), var(--glow-b), 0.8),
        0 0 12px rgba(var(--glow-r), var(--glow-g), var(--glow-b), 0.5);
    width: 100%;
    animation: title-flicker var(--flicker-speed) infinite;
    filter: blur(var(--text-title-blur));
}

/* POPUP OVERLAY */
.popup-overlay {
    position: fixed;
    inset: 0;
    background: transparent;
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 3;
    animation: fade-in 0.3s ease;
    overflow-y: auto; /* Allow scrolling if needed */
    padding: 20px 0; /* Padding for mobile */
}

.popup-overlay.active {
    display: flex;
}

@keyframes fade-in {
    from { opacity: 0; }
    to { opacity: 1; }
}

.popup-container {
    background: rgba(var(--popup-bg-r), var(--popup-bg-g), var(--popup-bg-b), 0.25);
    backdrop-filter: blur(25px) saturate(1.2);
    border: 1px solid rgba(var(--popup-border-r), var(--popup-border-g), var(--popup-border-b), 0.6);
    box-shadow: 
        0 0 60px rgba(var(--popup-border-r), var(--popup-border-g), var(--popup-border-b), 0.2),
        inset 0 0 50px rgba(var(--popup-border-r), var(--popup-border-g), var(--popup-border-b), 0.05);
    border-radius: 8px;
    padding: 40px;
    max-width: 520px;
    width: 90%;
    font-family: 'Courier New', monospace;
    animation: popup-appear 0.3s ease;
    text-align: center;
}

@keyframes popup-appear {
    from {
        opacity: 0;
        transform: scale(0.95);
    }
    to {
        opacity: 1;
        transform: scale(1);
    }
}

.popup-title {
    font-size: 13px;
    color: rgb(var(--popup-text-r), var(--popup-text-g), var(--popup-text-b));
    text-transform: uppercase;
    letter-spacing: 3px;
    margin-bottom: 25px;
    text-shadow: 
        0 0 8px rgba(var(--popup-glow-r), var(--popup-glow-g), var(--popup-glow-b), 0.8),
        0 0 16px rgba(var(--popup-glow-r), var(--popup-glow-g), var(--popup-glow-b), 0.5),
        0 0 32px rgba(var(--popup-glow-r), var(--popup-glow-g), var(--popup-glow-b), 0.3);
    animation: title-flicker 0.3s infinite;
    filter: blur(var(--text-title-blur));
}

.popup-content {
    color: rgba(var(--popup-text-r), var(--popup-text-g), var(--popup-text-b), 0.85);
    font-size: 12px;
    line-height: 1.8;
    margin-bottom: 25px;
    filter: blur(var(--text-body-blur));
}

.popup-field {
    margin-bottom: 15px;
}

.popup-label {
    color: rgba(var(--popup-label-r), var(--popup-label-g), var(--popup-label-b), 0.7);
    font-size: 9px;
    letter-spacing: 2px;
    text-transform: uppercase;
    margin-bottom: 5px;
    filter: blur(var(--text-body-blur));
}

.popup-value {
    color: rgba(var(--popup-text-r), var(--popup-text-g), var(--popup-text-b), 0.95);
    font-size: 13px;
    letter-spacing: 1px;
    filter: blur(var(--text-body-blur));
}

.popup-description {
    margin: 25px 0;
    padding: 20px;
    background: rgba(0, 0, 0, 0.3);
    backdrop-filter: blur(6px);
    border: 1px solid rgba(var(--popup-border-r), var(--popup-border-g), var(--popup-border-b), 0.3);
    border-radius: 4px;
    text-align: left;
    line-height: 1.9;
    filter: blur(var(--text-body-blur));
}

.popup-warning {
    margin: 25px 0;
    padding: 20px;
    background: rgba(var(--popup-border-r), var(--popup-border-g), var(--popup-border-b), 0.12);
    backdrop-filter: blur(6px);
    border: 1px solid rgba(var(--popup-border-r), var(--popup-border-g), var(--popup-border-b), 0.4);
    border-radius: 4px;
    color: rgba(var(--popup-text-r), var(--popup-text-g), var(--popup-text-b), 0.9);
    text-align: left;
    line-height: 1.9;
    filter: blur(var(--text-body-blur));
}

.password-note {
    margin: 25px 0;
    padding: 15px;
    background: rgba(var(--popup-border-r), var(--popup-border-g), var(--popup-border-b), 0.08);
    backdrop-filter: blur(4px);
    border: 1px solid rgba(var(--popup-border-r), var(--popup-border-g), var(--popup-border-b), 0.3);
    border-radius: 4px;
    text-align: center;
    font-size: 10px;
    color: rgba(var(--popup-text-r), var(--popup-text-g), var(--popup-text-b), 0.8);
    letter-spacing: 1px;
    filter: blur(var(--text-body-blur));
}

.popup-buttons {
    display: flex;
    gap: 15px;
    justify-content: center;
    margin-top: 30px;
}

.popup-button {
    padding: 12px 30px;
    background: rgba(var(--popup-border-r), var(--popup-border-g), var(--popup-border-b), 0.15);
    border: 1px solid rgba(var(--popup-border-r), var(--popup-border-g), var(--popup-border-b), 0.5);
    color: rgb(var(--popup-text-r), var(--popup-text-g), var(--popup-text-b));
    font-size: 11px;
    letter-spacing: 2px;
    text-transform: uppercase;
    cursor: crosshair;
    transition: all 0.3s;
    font-family: 'Courier New', monospace;
    border-radius: 3px;
    filter: blur(var(--text-body-blur));
}

.popup-button:hover {
    background: rgba(var(--popup-border-r), var(--popup-border-g), var(--popup-border-b), 0.3);
    box-shadow: 0 0 20px rgba(var(--popup-border-r), var(--popup-border-g), var(--popup-border-b), 0.4);
    transform: translateY(-1px);
}

/* PASSWORD FLASH - Ocean specimen notification (LEAK-WORM style) */
.password-flash {
    /* EXACT CENTER POSITIONING */
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    
    /* TYPOGRAPHY */
    font-family: 'Courier New', monospace;
    font-size: 13px;
    font-weight: 700;
    letter-spacing: 3px;
    text-transform: uppercase;
    text-align: center;
    
    /* OCEAN COLORS - Deep ocean blue with cyan glow */
    color: rgb(220, 240, 255);
    text-shadow: 
        0 0 10px rgba(0, 200, 255, 1.0),
        0 0 20px rgba(0, 200, 255, 0.8),
        0 0 40px rgba(0, 200, 255, 0.5);
    
    /* BEHAVIOR */
    z-index: 500;
    display: none;
    opacity: 0;
    animation: message-flicker 0.15s infinite;
    pointer-events: none;
    
    /* CONTAINER BOX */
    padding: 20px 35px;
    background: rgba(0, 30, 50, 0.95);
    border: 1px solid rgba(0, 200, 255, 0.6);
    border-radius: 3px;
    box-shadow: 
        0 0 30px rgba(0, 100, 150, 0.5),
        inset 0 0 20px rgba(0, 200, 255, 0.1);
    
    /* RESPONSIVE */
    max-width: 85vw;
    line-height: 1.5;
}

@keyframes message-flicker {
    0%, 100% { opacity: 1; }
    10% { opacity: 0.85; }
    20% { opacity: 1; }
    50% { opacity: 0.92; }
    60% { opacity: 1; }
}

.password-flash-text {
    /* Text inherits styling from parent */
}

/* BEAM INTERACTIONS */
.archive-title.beam-approaching,
.archive-subtitle.beam-approaching,
.date-tag.beam-approaching {
    opacity: 1;
    filter: brightness(1.1);
    transition: all 0.15s ease-out;
}

.archive-title.beam-contact {
    filter: blur(0px) brightness(1.5) !important;
    text-shadow: 
        0 0 12px rgba(var(--title-r), var(--title-g), var(--title-b), 1.0),
        0 0 24px rgba(var(--title-r), var(--title-g), var(--title-b), 0.9),
        0 0 48px rgba(var(--title-r), var(--title-g), var(--title-b), 0.7) !important;
    transition: all 0.08s ease-out;
}

.archive-subtitle.beam-contact,
.date-tag.beam-contact {
    filter: blur(0px) brightness(1.4) !important;
    text-shadow: 
        0 0 10px rgba(var(--subtitle-r), var(--subtitle-g), var(--subtitle-b), 1.0),
        0 0 20px rgba(var(--subtitle-r), var(--subtitle-g), var(--subtitle-b), 0.8),
        0 0 40px rgba(var(--subtitle-r), var(--subtitle-g), var(--subtitle-b), 0.6) !important;
    transition: all 0.08s ease-out;
}

.popup-title.beam-approaching,
.popup-label.beam-approaching,
.popup-value.beam-approaching,
.popup-button.beam-approaching,
.popup-description.beam-approaching,
.popup-warning.beam-approaching,
.password-note.beam-approaching {
    opacity: 1;
    filter: brightness(1.1);
    transition: all 0.15s ease-out;
}

.popup-title.beam-contact,
.popup-label.beam-contact,
.popup-value.beam-contact,
.popup-button.beam-contact {
    filter: blur(0px) brightness(1.4) !important;
    text-shadow: 
        0 0 10px rgba(var(--popup-glow-r), var(--popup-glow-g), var(--popup-glow-b), 1.0),
        0 0 20px rgba(var(--popup-glow-r), var(--popup-glow-g), var(--popup-glow-b), 0.9),
        0 0 40px rgba(var(--popup-glow-r), var(--popup-glow-g), var(--popup-glow-b), 0.7) !important;
    transition: all 0.08s ease-out;
}

.popup-description.beam-contact,
.popup-warning.beam-contact,
.password-note.beam-contact {
    filter: blur(0px) brightness(1.25) !important;
    border-color: rgba(var(--popup-border-r), var(--popup-border-g), var(--popup-border-b), 0.8) !important;
    box-shadow: 0 0 20px rgba(var(--popup-border-r), var(--popup-border-g), var(--popup-border-b), 0.4) !important;
    transition: all 0.08s ease-out;
}

/* RESPONSIVE */
@media (max-width: 1024px) and (min-width: 769px) {
    /* TABLET: 2-column grid */
    .crt {
        justify-content: flex-start; /* Start at top on tablet */
        padding: 30px 0;
    }
    
    /* Adjust border for tablet */
    .tank-border {
        inset: 6px;
        border-radius: 10px;
    }
    
    .membrane-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 20px;
        justify-items: center; /* Center items within grid */
        max-width: 600px; /* Constrain width for better centering */
        margin: 0 auto; /* Center the grid container itself */
    }
    
    .membrane {
        width: 100%; /* Full width of grid column */
        max-width: 280px; /* But not too wide */
    }
}

@media (max-width: 768px) {
    /* Ensure proper scrolling on mobile */
    .crt {
        justify-content: flex-start; /* Always start at top on mobile */
        padding: 20px 0; /* Reduced padding for mobile */
    }
    
    /* Tighter border on mobile with softer corners */
    .tank-border {
        inset: 4px; /* Closer to edge on mobile */
        border-radius: 8px; /* Slightly tighter radius */
    }
    
    .membrane-grid {
        grid-template-columns: 1fr; /* Force single column on mobile */
        gap: 15px;
        padding: 0 20px;
        justify-items: center; /* Center items within grid */
        max-width: 400px; /* Constrain width for better centering */
        margin: 0 auto; /* Center the grid container itself */
    }
    
    .membrane {
        min-height: 70px;
        max-height: 90px;
        padding: 6px 8px;
        width: 100%; /* Full width of grid column */
        max-width: 360px; /* But not too wide */
    }
    
    .membrane-code {
        font-size: 11px;
        letter-spacing: 1px;
    }

    .tank-header {
        padding: 0 20px 30px 20px;
    }
    
    .tank-footer {
        padding: 30px 20px 0 20px;
    }
    
    .archive-title {
        font-size: 20px;
        letter-spacing: 3px;
    }
    
    .archive-subtitle {
        font-size: 11px;
    }
    
    .date-tag {
        font-size: 9px;
    }
    
    /* MOBILE POPUP FIXES - Make scrollable */
    .popup-container {
        padding: 20px;
        max-height: 85vh; /* Don't exceed viewport */
        overflow-y: auto; /* Enable scrolling */
        -webkit-overflow-scrolling: touch; /* Smooth iOS scrolling */
    }
    
    .popup-title {
        font-size: 12px;
        margin-bottom: 20px;
    }
    
    .popup-content {
        font-size: 11px;
        margin-bottom: 20px;
    }
    
    .popup-field {
        margin-bottom: 12px;
    }
    
    .popup-description,
    .popup-warning,
    .password-note {
        padding: 15px;
        margin: 20px 0;
        font-size: 11px;
    }
    
    .popup-buttons {
        margin-top: 20px;
        flex-direction: column; /* Stack buttons vertically */
        gap: 10px;
    }
    
    .popup-button {
        width: 100%; /* Full width buttons */
        padding: 12px 20px;
    }
    
    .password-flash {
        padding: 15px 25px;
        max-width: 90vw;
    }
    
    .password-flash-text {
        font-size: 11px;
        letter-spacing: 2px;
    }
}

/* BEAM SYSTEM */
.beam-system {
    position: fixed;
    width: 100%;
    height: 100%;
    top: 0;
    left: 0;
    z-index: 50;
    pointer-events: none;
}

.beam-body {
    position: absolute;
    width: 100%;
    height: 2px;
    left: 0;
    background: linear-gradient(to right,
        transparent 0%,
        rgba(var(--beam-color-r), var(--beam-color-g), var(--beam-color-b), 0.03) 10%,
        rgba(var(--beam-color-r), var(--beam-color-g), var(--beam-color-b), 0.06) 50%,
        rgba(var(--beam-color-r), var(--beam-color-g), var(--beam-color-b), 0.03) 90%,
        transparent 100%
    );
    animation: beam-scan var(--beam-speed) linear infinite;
}

.beam-glow {
    position: absolute;
    width: 100%;
    height: 12px;
    left: 0;
    transform: translateY(-5px);
    background: linear-gradient(to right,
        transparent 20%,
        rgba(var(--beam-color-r), var(--beam-color-g), var(--beam-color-b), 0.04) 50%,
        transparent 80%
    );
    filter: blur(4px);
    animation: beam-scan var(--beam-speed) linear infinite;
    opacity: 0.15;
    transition: opacity 0.1s, filter 0.1s;
}

.beam-glow.approaching {
    opacity: 0.25;
    filter: blur(6px) brightness(1.2);
}

.beam-hotspot {
    position: absolute;
    width: 100%;
    height: 1px;
    left: 0;
    animation: beam-scan var(--beam-speed) linear infinite;
    opacity: 0.1;
    transition: opacity 0.05s;
}

.beam-hotspot.active {
    opacity: 0.3;
}

@keyframes beam-scan {
    from { 
        top: var(--beam-start-position);
        opacity: 0;
    }
    2% { opacity: 1; }
    98% { opacity: 1; }
    to { 
        top: 100%;
        opacity: 0;
    }
}

/* PARTICLES */
.particle-container {
    position: fixed;
    inset: 0;
    overflow: hidden;
    pointer-events: none;
    z-index: 1;
}

.particle-field {
    position: absolute;
    width: 100%;
    height: 100%;
}

.particle {
    position: absolute;
    border-radius: 50%;
    background: rgba(var(--glow-r), var(--glow-g), var(--glow-b), 1.0);
    opacity: calc(var(--particle-base-opacity) * var(--particle-decay-multiplier));
    will-change: transform, opacity;
    transform: translateZ(0);
    transition: opacity 0.3s ease-out;
    box-shadow: 0 0 2px rgba(var(--glow-r), var(--glow-g), var(--glow-b), 0.3);
    min-width: 1.5px;
    min-height: 1.5px;
    animation: drift-up linear infinite;
}

@keyframes drift-up {
    from { transform: translateY(110vh); }
    to { transform: translateY(-10vh); }
}

.particle[data-layer="far"] { z-index: 1; }
.particle[data-layer="mid"] { z-index: 2; }
.particle[data-layer="near"] { z-index: 3; }

.particle.beam-revealed {
    opacity: calc(var(--particle-base-opacity) * 3.5 * var(--particle-decay-multiplier)) !important;
}
</style>
</head>
<body>

<div class="crt">
    <div class="tank-header">
        <div class="archive-title">LOOKAWAY TANK</div>
        <div class="archive-subtitle">Hunterian Preservation System</div>
    </div>
    
    <div class="membrane-grid" id="membraneGrid"></div>
    
    <div class="tank-footer">
        <div class="date-tag" id="dateTag"></div>
    </div>
    
    <div class="popup-overlay" id="popupOverlay">
        <div class="popup-container">
            <div class="popup-title" id="popupTitle">SPECIMEN CONTAINMENT PROTOCOL</div>
            <div class="popup-content" id="popupContent"></div>
            <div class="popup-buttons">
                <button class="popup-button" id="observeBtn">OBSERVE SPECIMEN</button>
                <button class="popup-button" id="retrievePasswordBtn" style="display:none;">RETRIEVE PASSWORD</button>
            </div>
        </div>
    </div>
</div>

<div class="vignette"></div>
<div class="tank-border"></div>
<div class="scanlines"></div>

<div class="password-flash" id="passwordFlash">
    <div class="password-flash-text">PASSWORD LEAKED TO CLIPBOARD</div>
</div>

<script src="tank-config.js"></script>
<script src="tank-specimens.js"></script>
<script src="tank-decay.js"></script>
<script src="tank-beam.js"></script>
<script src="tank-particles.js"></script>
<script src="tank-audio.js"></script>

<script>
const tank = {
    currentPopup: null,
    initialized: false
};

function generateMembraneGrid() {
    const grid = document.getElementById('membraneGrid');
    
    SPECIMENS.registry.forEach(specimen => {
        const membrane = document.createElement('div');
        membrane.className = 'membrane';
        membrane.dataset.specimenId = specimen.id;
        
        if (specimen.status === 'contained') {
            membrane.classList.add('active');
            
            // âœ… APPLY SPECIMEN COLOR (Data-Driven)
            if (specimen.color) {
                const { r, g, b } = specimen.color;
                membrane.style.setProperty('--specimen-r', r);
                membrane.style.setProperty('--specimen-g', g);
                membrane.style.setProperty('--specimen-b', b);
                membrane.classList.add('has-specimen');
            }
            
            // âœ… APPLY BEHAVIORS (Data-Driven)
            if (specimen.behaviors) {
                // Idle animation
                if (specimen.behaviors.idleAnimation && specimen.behaviors.idleAnimation !== 'none') {
                    membrane.classList.add(`anim-${specimen.behaviors.idleAnimation}`);
                    if (specimen.behaviors.animationSpeed) {
                        membrane.style.setProperty('--anim-speed', `${specimen.behaviors.animationSpeed}s`);
                    }
                }
                
                // Hover effect class (for future hover customization)
                if (specimen.behaviors.hoverEffect) {
                    membrane.classList.add(`hover-${specimen.behaviors.hoverEffect}`);
                }
            }
            
            // Add classification-based class (for future styling)
            if (specimen.classification) {
                const classSlug = specimen.classification.toLowerCase().replace(/\s+/g, '-');
                membrane.classList.add(`class-${classSlug}`);
            }
            
        } else {
            membrane.classList.add('empty');
        }
        
        membrane.innerHTML = `<div class="membrane-code">${specimen.code}</div>`;
        
        if (specimen.status === 'contained') {
            membrane.addEventListener('click', () => {
                openPopup(specimen.id);
            });
        }
        
        grid.appendChild(membrane);
    });
    
    console.log('âœ… Membranes generated (data-driven colors & behaviors)');
}

function openPopup(specimenId) {
    const popupData = SPECIMENS.getPopupContent(specimenId);
    if (!popupData) return;
    
    tank.currentPopup = specimenId;
    
    const overlay = document.getElementById('popupOverlay');
    const title = document.getElementById('popupTitle');
    const content = document.getElementById('popupContent');
    const observeBtn = document.getElementById('observeBtn');
    const retrievePasswordBtn = document.getElementById('retrievePasswordBtn');
    
    title.textContent = popupData.title;
    
    content.innerHTML = `
        <div class="popup-field">
            <div class="popup-label">Designation</div>
            <div class="popup-value">${popupData.code}</div>
        </div>
        <div class="popup-field">
            <div class="popup-label">Status</div>
            <div class="popup-value">${popupData.status}</div>
        </div>
        <div class="popup-field">
            <div class="popup-label">Classification</div>
            <div class="popup-value">${popupData.classification}</div>
        </div>
        <div class="popup-field">
            <div class="popup-label">Deployed</div>
            <div class="popup-value">${popupData.deployed}</div>
        </div>
        <div class="popup-description">
            ${popupData.description}
        </div>
        <div class="popup-warning">
            <strong>âš  WARNING:</strong> ${popupData.warning}
        </div>
        ${popupData.password ? `
        <div class="password-note">
            âš  ACCESS PASSWORD REQUIRED FOR SPECIMEN OBSERVATION
        </div>
        ` : ''}
    `;
    
    observeBtn.onclick = () => {
        if (popupData.url) {
            // Trigger membrane click sound first
            if (window.tankAudio) {
                window.tankAudio.triggerMembraneClick();
            }
            
            // Create fade-to-black overlay
            const fadeOverlay = document.createElement('div');
            fadeOverlay.style.cssText = `
                position: fixed;
                inset: 0;
                background: black;
                opacity: 0;
                z-index: 10000;
                pointer-events: none;
                transition: opacity 0.6s ease-out;
            `;
            document.body.appendChild(fadeOverlay);
            
            // Start fade
            setTimeout(() => {
                fadeOverlay.style.opacity = '1';
            }, 10);
            
            // Navigate after fade completes
            setTimeout(() => {
                window.location.href = popupData.url;
            }, 700);
        }
    };
    
    if (popupData.password) {
        retrievePasswordBtn.style.display = 'inline-block';
        retrievePasswordBtn.onclick = () => {
            leakSpecimenData(popupData.code, popupData.password, popupData.url);
        };
    } else {
        retrievePasswordBtn.style.display = 'none';
    }
    
    overlay.classList.add('active');
}

function closePopup() {
    const overlay = document.getElementById('popupOverlay');
    overlay.classList.remove('active');
    tank.currentPopup = null;
}

function showPasswordFlash() {
    const flash = document.getElementById('passwordFlash');
    flash.style.display = 'block';
    setTimeout(() => flash.style.opacity = '1', 10);
    setTimeout(() => {
        flash.style.opacity = '0';
        setTimeout(() => flash.style.display = 'none', 300);
    }, 2000); // Shows for 2 seconds
}

function leakSpecimenData(code, password, url) {
    // Copy ONLY the password - just the equation
    navigator.clipboard.writeText(password).then(() => {
        showPasswordFlash();
    }).catch(err => {
        console.error('Leak failed:', err);
        alert('Failed to copy password to clipboard');
    });
}

document.addEventListener('DOMContentLoaded', () => {
    if (typeof TANK_CONFIG === 'undefined') {
        console.error('âŒ tank-config.js not loaded!');
        return;
    }
    if (typeof SPECIMENS === 'undefined') {
        console.error('âŒ tank-specimens.js not loaded!');
        return;
    }
    if (typeof tankDecay === 'undefined') {
        console.error('âŒ tank-decay.js not loaded!');
        return;
    }
    
    console.log('ðŸ“‹ Initializing Hunterian Tank...');
    
    const dateTag = document.getElementById('dateTag');
    
    // Update date and time
    function updateDateTime() {
        const now = new Date();
        const dateOptions = { year: 'numeric', month: 'long', day: 'numeric' };
        const dateStr = now.toLocaleDateString('en-US', dateOptions);
        
        // 24-hour format
        const hours = String(now.getHours()).padStart(2, '0');
        const minutes = String(now.getMinutes()).padStart(2, '0');
        const seconds = String(now.getSeconds()).padStart(2, '0');
        const timeStr = `${hours}:${minutes}:${seconds}`;
        
        dateTag.textContent = `Tank Access: ${dateStr} â€” ${timeStr}`;
    }
    
    // Initial update and start clock
    updateDateTime();
    setInterval(updateDateTime, 1000);
    
    generateMembraneGrid();
    tankDecay.start();
    
    if (typeof TankBeamModule !== 'undefined') {
        window.tankBeam = new TankBeamModule();
        window.tankBeam.init();
    }
    
    if (typeof TankParticleDrift !== 'undefined') {
        window.tankParticles = new TankParticleDrift();
        window.tankParticles.init();
    }
    
    document.getElementById('popupOverlay').addEventListener('click', (e) => {
        if (e.target.id === 'popupOverlay') {
            closePopup();
        }
    });
    
    document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && tank.currentPopup) {
            closePopup();
        }
    });
    
    const resetFlicker = () => tankDecay.reset();
    document.addEventListener('scroll', resetFlicker);
    document.addEventListener('mousemove', resetFlicker);
    document.addEventListener('click', resetFlicker);
    document.addEventListener('touchstart', resetFlicker);
    document.addEventListener('keydown', resetFlicker);
    
    tank.initialized = true;
    console.log('âœ… Hunterian Tank operational (HOT AMBER + ELECTRIC)');
    console.log('ðŸ§¬ Specimen colors applied:', SPECIMENS.countActive(), 'active');
    console.log('ðŸŽ­ Behaviors loaded from specimen data');
});
</script>

</body>
</html>